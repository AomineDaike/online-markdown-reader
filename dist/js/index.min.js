!function(){function e(e){var t=JSON.parse(e);for(var a in t){var o=t[a];void 0!==o?a in F&&(F[a]=o):console.warn("'"+a+"' parameter is undefined.")}localStorage.setItem(U.DHShort,F.short_name)}function t(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#3bafda")}function a(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd")}function o(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd"),null!=e.dataTransfer.files&&null!=e.dataTransfer.files[0]&&s(e.dataTransfer.files[0])}function n(e){e.stopPropagation(),e.preventDefault(),null!=this.files&&null!=this.files[0]&&s(this.files[0])}function s(e){if(M=e,!I(M.name)){var t=$("[data-remodal-id=md-tip]").remodal();return void t.open()}$("#loader").css("display","block");var a=new FileReader;a.readAsText(M),P=w(M.name),a.onload=function(e){A=e.target.result,V.cache?l(P,A):d(),r(A)}}function r(e){q.length=0,J="",b(e),c(P),$("#content").html(marked(e)),f(),V.genToc&&y(),V.highlight==U.highlight?$("pre code").each(function(e,t){hljs.highlightBlock(t)}):($("pre").addClass("line-numbers"),Prism.highlightAll()),V.mathjax&&(null!=MathJax.Extension["TeX/AMSmath"]&&(MathJax.Extension["TeX/AMSmath"].startNumber=0,MathJax.Extension["TeX/AMSmath"].labels={}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"content"])),V.emoji&&emojify.run(document.getElementById("content")),V.sd&&$(".diagram").sequenceDiagram({theme:"simple"}),V.duoshuo&&$("#content").html(),$("#loader").css("display","none"),S()}function i(){null==M?r(A):s(M)}function l(e,t){if(t.length>O){var a=$("[data-remodal-id=size-tip]").remodal();return a.open(),void d()}localStorage.setItem(U.mdName,e),localStorage.setItem(U.mdContent,t)}function c(e){F.key=e,F.title=e,F.url=e+".html"}function d(){localStorage.removeItem(U.mdName),localStorage.removeItem(U.mdContent)}function h(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#3bafda")}function m(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#ddd")}function u(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),g(e.dataTransfer.files)}function p(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),g(this.files)}function g(e){var t,a=e.length,o=0;for(t=0;t<e.length;t++)if(!L(e[t].name)){var n=$("[data-remodal-id=img-tip]").remodal();return void n.open()}for($("#loader").css("display","block"),t=0;t<e.length;t++){var s=e[t],r=new FileReader;r.readAsDataURL(s),function(e,t){e.onload=function(e){if(V.compressImg){var n=new Image;n.src=e.target.result;var s=E(t.name),r="image/png";"jpg"!=s.toLowerCase()&&"jpeg"!=s.toLowerCase()||(r="image/jpeg"),N[t.name]=v(n,r)}else N[t.name]=e.target.result;o++,o==a&&f()}}(r,s)}}function f(){var e,t=$("img");for(e=0;e<t.length;e++){var a;null==$(t[e]).attr("pname")?(a=t[e].src,$(t[e]).attr("pName",a)):a=$(t[e]).attr("pname");var o=C(a);N.hasOwnProperty(o)&&(t[e].src=N[o])}$("#loader").css("display","none")}function v(e,t){var a=862,o=document.createElement("canvas"),n=e.width,s=e.height;null!=t&&""!=t||(t="image/png"),n>a&&(s=Math.round(s*=a/n),n=a),o.width=n,o.height=s;var r=o.getContext("2d");return r.drawImage(e,0,0,n,s),o.toDataURL(t)}function b(e){var t,a=/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/gim;if(B=e.indexOf(U.tocTag),z=0,B==-1)return void(R=!1);for(R=!0;null!=(t=a.exec(e))&&!(t.index>B);)z++}function y(){var e,t,a,o=0,n=V.tocLevel,s="",r=0;for(X=5,e=z;e<q.length;e++)a=q[e],a.level<X&&(X=a.level);for(o=X-1,e=z;e<q.length;e++)if(a=q[e],!(a.level>n)){if(o>a.level){for(t=o-a.level;t>=0;t--)s+="</ul>",r--;s+="<ul>",r++}if(o<a.level)for(t=a.level-o;t>0;t--)s+="<ul>",r++;s+="<li><a href='#"+a.slug+"'>"+a.title+"</a></li>",o=a.level}for(e=0;e<r;e++)s+="</ul>";if(R){var i=$("#content").html();i=i.replace(U.tocTag,s),$("#content").html(i)}else $("#content").prepend(s)}function k(){var e=localStorage.getItem(U.mdContent);return null==e||""==e?void $("#loader").css("display","none"):(P=localStorage.getItem(U.mdName),console.log(P),A=e,r(A),void $("#loader").css("display","none"))}function x(){var e=localStorage.getItem(U.setting);if(null!=e){e=JSON.parse(e);for(var t in e){var a=e[t];void 0!==a?t in V&&(V[t]=a):console.warn("'"+t+"' parameter is undefined.")}var o=localStorage.getItem(U.DHShort);null!=o&&(F.short_name=o)}}function j(){r(A),localStorage.setItem(U.setting,JSON.stringify(V))}function T(){$("[name='set']").each(function(e,t){$(t).prop("checked",V[$(t).attr("ref")]),$(t).change(function(e){V[$(t).attr("ref")]=$(t).is(":checked"),j()})}),$("#s_toc").prop("checked",V.genToc),$("#toc-level").val(V.tocLevel),$("#s_toc").change(function(e){V.genToc=$("#s_toc").is(":checked"),V.genToc?$("#toc-level").prop("disabled",!1):$("#toc-level").prop("disabled",!0),j()}),$("#toc-level").change(function(e){var t=parseInt($("#toc-level").val());t<1&&(t=1),t>5&&(t=5),V.tocLevel=t,$("#toc-level").val(t),j()}),V.highlight==U.highlight?$("#s_highlight").prop("checked",!0):$("#s_prism").prop("checked",!0),$("[name='high']").each(function(e,t){$(t).change(function(e){var a=$(t).prop("id");"s_highlight"==a?V.highlight=U.highlight:V.highlight=U.prism,j()})})}function S(){$("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)}function w(e){return e.substr(0,e.lastIndexOf("."))||e}function C(e){return e.substr(e.lastIndexOf("/")+1)}function E(e){return e.substr(e.lastIndexOf(".")+1)||e}function I(e){var t=/(\.md|\.markdown|\.txt|\.mkd|\.text)$/i;return!!t.test(e)}function L(e){var t=/(\.png|\.jpg|\.gif|\.bmp)$/i;return!!t.test(e)}var M,_=document.getElementById("select-file"),D=document.getElementById("img-select"),N={},P="",A="",O=4194304,q=[],H=0,J="",z=0,B=-1,R=!1,X=5,F={key:"test",title:"test",url:"test.html",short_name:"zhangjkblog"},U={highlight:"highlight",prism:"prism",mdName:"mdName",mdContent:"mdContent",tocTag:"<!-- toc -->",setting:"setting",DHShort:"duoshuoShort"},V={compressImg:!0,genToc:!0,tocLevel:5,highlight:U.prism,cache:!0,mathjax:!0,sd:!0,emoji:!0,backtop:!0,duoshuo:!0},Q=new marked.Renderer;Q.listitem=function(e){return/^\s*\[[x ]\]\s*/.test(e)?(e=e.replace(/^\s*\[ \]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled checked> '),'<li style="list-style: none">'+e+"</li>"):"<li>"+e+"</li>"},Q.heading=function(e,t){var a=e.toLowerCase().replace(/[\s]+/g,"-");return J.indexOf(a)!=-1&&(a+="-"+H,H++),J+=a,q.push({level:t,slug:a,title:e}),"<h"+t+' id="'+a+'"><a href="#'+a+'" class="anchor"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>'+e+"</h"+t+">"};var G=Q.code;Q.code=function(t,a){switch(a){case"seq":return"<div class='diagram' id='diagram'>"+t+"</div>";case"mathjax":return"<p>"+t+"</p>\n";case"duoshuo":return e(t),"";default:return G.call(this,t,a)}},marked.setOptions({renderer:Q}),_.addEventListener("dragenter",t,!1),_.addEventListener("dragleave",a,!1),_.addEventListener("drop",o,!1),_.addEventListener("change",n,!1),D.addEventListener("dragenter",h,!1),D.addEventListener("dragleave",m,!1),D.addEventListener("drop",u,!1),D.addEventListener("change",p,!1),$("#fold").click(function(){"true"==$("#fold").attr("expand")?($("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)):($("#fold").removeClass("fa-plus-square"),$("#fold").addClass("fa-minus-square"),$("#upload-area").removeClass("upload-area-close"),$("#fold").attr("expand",!0))}),$("#export").click(function(){var e="",t="",a="";V.highlight==U.highlight?t+='<link href="http://cdn.bootcss.com/highlight.js/9.8.0/styles/atom-one-light.min.css" rel="stylesheet">':(t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/themes/prism.min.css" rel="stylesheet">',t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">'),V.emoji&&(t+='<link href="http://cdn.bootcss.com/emojify.js/1.1.0/css/basic/emojify.min.css" rel="stylesheet">'),V.mathjax?(V.mathjax=!1,r(A),e=$("#content").html(),V.mathjax=!0,r(A)):e=$("#content").html(),V.mathjax&&(a+='<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [[\'$\',\'$\'], [\'\\\\(\',\'\\\\)\']]}, TeX: {equationNumbers: {autoNumber: ["AMS"],useLabelIds: true}},"HTML-CSS": {linebreaks: {automatic: true}},SVG: {linebreaks: {automatic: true}}});</script><script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>'),V.backtop&&(t+='<link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">',t+=' <link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/backtotop.min.css">',a+='<script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>',a+='<script type="text/javascript" src="http://markdown.zhangjikai.com/dist/js/backtotop.min.js"></script>',a+='<script type="text/javascript">backToTop.init()</script> '),V.duoshuo&&(a+='<div class="ds-thread" data-thread-key="'+F.key+'" data-title="'+F.title+'" data-url="'+F.url+'"></div><script type="text/javascript">var duoshuoQuery = {short_name:"'+F.short_name+'"};(function() {var ds = document.createElement("script");ds.type = "text/javascript";ds.async = true;ds.src = (document.location.protocol == "https:" ? "https:" : "http:") + "//static.duoshuo.com/embed.js";ds.charset = "UTF-8";(document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(ds);})();</script>');var e='<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+P+"</title>"+t+'<link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/markdown.min.css"></head><body>'+e+a+"</body></html>",o=P+".html",n=new Blob([html_beautify(e,{indent_size:4})],{type:"text/html;charset=utf-8"});saveAs(n,o)}),$("#refresh").click(function(){i()}),emojify.setConfig({emojify_tag_type:"div",only_crawl_id:null,img_dir:"http://cdn.bootcss.com/emojify.js/1.0/images/basic",ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),backToTop.init({theme:"classic",animation:"fade"}),x(),T(),k()}();