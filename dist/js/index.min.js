!function(){function e(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#3bafda")}function t(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd")}function a(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd"),null!=e.dataTransfer.files&&null!=e.dataTransfer.files[0]&&o(e.dataTransfer.files[0])}function n(e){e.stopPropagation(),e.preventDefault(),null!=this.files&&null!=this.files[0]&&o(this.files[0])}function o(e){if(E=e,!I(E.name)){var t=$("[data-remodal-id=md-tip]").remodal();return void t.open()}$("#loader").css("display","block");var a=new FileReader;a.readAsText(E),M=w(E.name),a.onload=function(e){P=e.target.result,F.cache?r(M,P):l(),i(P)}}function i(e){q.length=0,N="",f(e),$("#content").html(marked(e)),g(),F.genToc&&v(),F.highlight==J.highlight?$("pre code").each(function(e,t){hljs.highlightBlock(t)}):($("pre").addClass("line-numbers"),Prism.highlightAll()),F.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,"content"]),F.emoji&&emojify.run(document.getElementById("content")),F.sd&&$(".diagram").sequenceDiagram({theme:"simple"}),$("#loader").css("display","none"),j()}function s(){null==E?i(P):o(E)}function r(e,t){if(t.length>O){var a=$("[data-remodal-id=size-tip]").remodal();return a.open(),void l()}localStorage.setItem(J.mdName,e),localStorage.setItem(J.mdContent,t)}function l(){localStorage.removeItem(J.mdName),localStorage.removeItem(J.mdContent)}function c(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#3bafda")}function d(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#ddd")}function h(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),p(e.dataTransfer.files)}function m(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),p(this.files)}function p(e){var t,a=e.length,n=0;for(t=0;t<e.length;t++)if(!L(e[t].name)){var o=$("[data-remodal-id=img-tip]").remodal();return void o.open()}for($("#loader").css("display","block"),t=0;t<e.length;t++){var i=e[t],s=new FileReader;s.readAsDataURL(i),function(e,t){e.onload=function(e){if(F.compressImg){var o=new Image;o.src=e.target.result;var i=T(t.name),s="image/png";"jpg"!=i.toLowerCase()&&"jpeg"!=i.toLowerCase()||(s="image/jpeg"),D[t.name]=u(o,s)}else D[t.name]=e.target.result;n++,n==a&&g()}}(s,i)}}function g(){var e,t=$("img");for(e=0;e<t.length;e++){var a;null==$(t[e]).attr("pname")?(a=t[e].src,$(t[e]).attr("pName",a)):a=$(t[e]).attr("pname");var n=C(a);D.hasOwnProperty(n)&&(t[e].src=D[n])}$("#loader").css("display","none")}function u(e,t){var a=862,n=document.createElement("canvas"),o=e.width,i=e.height;null!=t&&""!=t||(t="image/png"),o>a&&(i=Math.round(i*=a/o),o=a),n.width=o,n.height=i;var s=n.getContext("2d");return s.drawImage(e,0,0,o,i),n.toDataURL(t)}function f(e){var t,a=/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/gim;if(z=e.indexOf(J.tocTag),R=0,z==-1)return void(H=!1);for(H=!0;null!=(t=a.exec(e))&&!(t.index>z);)R++}function v(){var e,t,a,n=0,o=F.tocLevel,i="",s=0;for(B=5,e=R;e<q.length;e++)a=q[e],a.level<B&&(B=a.level);for(n=B-1,e=R;e<q.length;e++)if(a=q[e],!(a.level>o)){if(n>a.level){for(t=n-a.level;t>=0;t--)i+="</ul>",s--;i+="<ul>",s++}if(n<a.level)for(t=a.level-n;t>0;t--)i+="<ul>",s++;i+="<li><a href='#"+a.slug+"'>"+a.title+"</a></li>",n=a.level}for(e=0;e<s;e++)i+="</ul>";if(H){var r=$("#content").html();r=r.replace(J.tocTag,i),$("#content").html(r)}else $("#content").prepend(i)}function b(){var e=localStorage.getItem(J.mdContent);return null==e||""==e?void $("#loader").css("display","none"):(M=localStorage.getItem(J.mdName),console.log(M),P=e,i(P),void $("#loader").css("display","none"))}function k(){var e=localStorage.getItem(J.setting);if(null!=e){e=JSON.parse(e);for(var t in e){var a=e[t];void 0!==a?t in F&&(F[t]=a):console.warn("'"+t+"' parameter is undefined.")}}}function x(){i(P),localStorage.setItem(J.setting,JSON.stringify(F))}function y(){$("[name='set']").each(function(e,t){$(t).prop("checked",F[$(t).attr("ref")]),$(t).change(function(e){F[$(t).attr("ref")]=$(t).is(":checked"),x()})}),$("#s_toc").prop("checked",F.genToc),$("#toc-level").val(F.tocLevel),$("#s_toc").change(function(e){F.genToc=$("#s_toc").is(":checked"),F.genToc?$("#toc-level").prop("disabled",!1):$("#toc-level").prop("disabled",!0),x()}),$("#toc-level").change(function(e){var t=parseInt($("#toc-level").val());t<1&&(t=1),t>5&&(t=5),F.tocLevel=t,$("#toc-level").val(t),x()}),F.highlight==J.highlight?$("#s_highlight").prop("checked",!0):$("#s_prism").prop("checked",!0),$("[name='high']").each(function(e,t){$(t).change(function(e){var a=$(t).prop("id");"s_highlight"==a?F.highlight=J.highlight:F.highlight=J.prism,x()})})}function j(){$("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)}function w(e){return e.substr(0,e.lastIndexOf("."))||e}function C(e){return e.substr(e.lastIndexOf("/")+1)}function T(e){return e.substr(e.lastIndexOf(".")+1)||e}function I(e){var t=/(\.md|\.markdown|\.txt|\.mkd|\.text)$/i;return!!t.test(e)}function L(e){var t=/(\.png|\.jpg|\.gif|\.bmp)$/i;return!!t.test(e)}var E,S=document.getElementById("select-file"),_=document.getElementById("img-select"),D={},M="",P="",O=4194304,q=[],A=0,N="",R=0,z=-1,H=!1,B=5,J={highlight:"highlight",prism:"prism",mdName:"mdName",mdContent:"mdContent",tocTag:"<!-- toc -->",setting:"setting"},F={compressImg:!0,genToc:!0,tocLevel:5,highlight:J.prism,cache:!0,mathjax:!0,sd:!0,emoji:!0,backtop:!0},U=new marked.Renderer;U.listitem=function(e){return/^\s*\[[x ]\]\s*/.test(e)?(e=e.replace(/^\s*\[ \]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled checked> '),'<li style="list-style: none">'+e+"</li>"):"<li>"+e+"</li>"},U.heading=function(e,t){var a=e.toLowerCase().replace(/[\s]+/g,"-");return N.indexOf(a)!=-1&&(a+="-"+A,A++),N+=a,q.push({level:t,slug:a,title:e}),"<h"+t+' id="'+a+'"><a href="#'+a+'" class="anchor"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>'+e+"</h"+t+">"};var V=U.code;U.code=function(e,t){return"seq"==t?"<div class='diagram' id='diagram'>"+e+"</div>":V.call(this,e,t)},marked.setOptions({renderer:U}),S.addEventListener("dragenter",e,!1),S.addEventListener("dragleave",t,!1),S.addEventListener("drop",a,!1),S.addEventListener("change",n,!1),_.addEventListener("dragenter",c,!1),_.addEventListener("dragleave",d,!1),_.addEventListener("drop",h,!1),_.addEventListener("change",m,!1),$("#fold").click(function(){"true"==$("#fold").attr("expand")?($("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)):($("#fold").removeClass("fa-plus-square"),$("#fold").addClass("fa-minus-square"),$("#upload-area").removeClass("upload-area-close"),$("#fold").attr("expand",!0))}),$("#export").click(function(){var e="",t="",a="";F.highlight==J.highlight?t+='<link href="http://cdn.bootcss.com/highlight.js/9.8.0/styles/atom-one-light.min.css" rel="stylesheet">':(t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/themes/prism.min.css" rel="stylesheet">',t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">'),F.emoji&&(t+='<link href="http://cdn.bootcss.com/emojify.js/1.1.0/css/basic/emojify.min.css" rel="stylesheet">'),F.mathjax?(0==F.mathjax,i(P),e=$("#content").html(),1==F.mathjax,i(P)):e=$("#content").html(),F.mathjax&&(a+="<script type=\"text/x-mathjax-config\">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});</script>"+'<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>'),F.backtop&&(t+='<link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">',t+=' <link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/backtotop.min.css">',a+='<script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>',a+='<script type="text/javascript" src="http://markdown.zhangjikai.com/dist/js/backtotop.min.js"></script>',a+='<script type="text/javascript">backToTop.init()</script> ');var e='<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+M+"</title>"+t+'<link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/markdown.min.css"></head><body>'+e+a+"</body></html>",n=M+".html",o=new Blob([html_beautify(e,{indent_size:4})],{type:"text/html;charset=utf-8"});saveAs(o,n)}),$("#refresh").click(function(){s()}),emojify.setConfig({emojify_tag_type:"div",only_crawl_id:null,img_dir:"http://cdn.bootcss.com/emojify.js/1.0/images/basic",ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),backToTop.init({theme:"classic",animation:"fade"}),k(),y(),b()}();